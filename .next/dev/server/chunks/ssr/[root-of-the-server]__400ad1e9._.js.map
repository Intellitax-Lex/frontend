{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/anadesouza/Documents/intellitax-lex/app/registro/page.tsx"],"sourcesContent":["// app/(public)/registro/page.tsx\n'use client';\n\nimport React, { useState } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n// import { createClient as createClientComponentClient } from '@/lib/supabase/client';\nimport { Loader2 } from 'lucide-react';\n\n// Definimos el tipo de Plan para TypeScript (del ENUM de la DB)\ntype Plan = 'personal' | 'profesional' | 'estudio';\n\nexport default function RegistroPage() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  \n  // Estado para el plan seleccionado. 'personal' por defecto.\n  const [plan, setPlan] = useState<Plan>('personal'); \n  const [orgName, setOrgName] = useState('');\n  const [agreedToPolicy, setAgreedToPolicy] = useState(false);\n  \n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const router = useRouter();\n  // const supabase = createClientComponentClient();\n\n  // ESTA ES LA FUNCIÓN CLAVE QUE LLAMA AL TRIGGER 1\n  const handleRegister = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setError(null);\n    setIsLoading(true);\n\n    // --- Validaciones del Front-End ---\n    if (password !== confirmPassword) {\n      setError(\"Las contraseñas no coinciden.\");\n      setIsLoading(false);\n      return;\n    }\n    if (plan !== 'personal' && !orgName) {\n      setError(\"Por favor, ingrese el nombre de su organización.\");\n      setIsLoading(false);\n      return;\n    }\n    if (!agreedToPolicy) {\n      setError(\"Debe aceptar la Política de Privacidad para continuar.\");\n      setIsLoading(false);\n      return;\n    }\n\n    // --- ¡LA LÓGICA DEL TRIGGER! ---\n    // Preparamos el objeto 'options.data' que leerá el Trigger\n    // 'handle_new_user' en la base de datos.\n    const options = {\n      data: {\n        plan: plan,\n        // Solo enviamos 'org_name' si el plan no es 'personal'\n        org_name: plan !== 'personal' ? orgName : undefined, \n        // (Ana podría añadir un 'full_name' aquí si lo pide en el form)\n      }\n    };\n\n    // --- Llamada a Supabase Auth ---\n    // const { error: signUpError } = await supabase.auth.signUp({\n    //   email,\n    //   password,\n    //   options, // <-- Aquí pasamos los metadatos\n    // });\n\n    const signUpError = null;\n\n    if (signUpError) {\n      setError(signUpError.message);\n      setIsLoading(false);\n    } else {\n      // Éxito. Redirigimos al usuario al dashboard.\n      // (Supabase puede requerir verificación de email, pero el Trigger 1\n      // YA creó la suscripción en la DB).\n      router.push('/dashboard'); // Redirige a la app\n      router.refresh();\n    }\n  };\n\n  return (\n    <div className=\"flex min-h-full flex-1 flex-col justify-center px-6 py-12 lg:px-8\">\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\n        <h2 className=\"mt-6 text-center text-3xl font-bold tracking-tight text-teal-400\">\n          IntelliTax Lex\n        </h2>\n        <h3 className=\"mt-2 text-center text-xl font-medium text-white\">\n          Crea tu cuenta nueva\n        </h3>\n      </div>\n\n      <div className=\"mt-10 sm:mx-auto sm:w-full sm:max-w-md\">\n        <div className=\"bg-blue-900 p-8 shadow-xl ring-1 ring-blue-700 sm:rounded-lg\">\n          <form className=\"space-y-6\" onSubmit={handleRegister}>\n            {/* Campo de Email */}\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium leading-6 text-blue-200\">Email</label>\n              <div className=\"mt-2\">\n                <input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  required\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  className=\"block w-full rounded-md border-0 bg-blue-800/50 py-2.5 text-white ring-1 ring-inset ring-blue-700 focus:ring-2 focus:ring-inset focus:ring-teal-500\"\n                />\n              </div>\n            </div>\n\n            {/* Campo de Contraseña */}\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium leading-6 text-blue-200\">Contraseña (mínimo 6 caracteres)</label>\n              <div className=\"mt-2\">\n                <input\n                  id=\"password\"\n                  name=\"password\"\n                  type=\"password\"\n                  required\n                  minLength={6}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className=\"block w-full rounded-md border-0 bg-blue-800/50 py-2.5 text-white ring-1 ring-inset ring-blue-700 focus:ring-2 focus:ring-inset focus:ring-teal-500\"\n                />\n              </div>\n            </div>\n\n            {/* Campo de Confirmar Contraseña */}\n            <div>\n              <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium leading-6 text-blue-200\">Confirmar Contraseña</label>\n              <div className=\"mt-2\">\n                <input\n                  id=\"confirmPassword\"\n                  name=\"confirmPassword\"\n                  type=\"password\"\n                  required\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  className=\"block w-full rounded-md border-0 bg-blue-800/50 py-2.5 text-white ring-1 ring-inset ring-blue-700 focus:ring-2 focus:ring-inset focus:ring-teal-500\"\n                />\n              </div>\n            </div>\n\n            {/* Selección de Plan */}\n            <fieldset className=\"mt-4\">\n              <legend className=\"block text-sm font-medium leading-6 text-blue-200\">Selecciona tu Plan</legend>\n              <div className=\"mt-2 grid grid-cols-2 gap-4\">\n                {/* Opción Personal */}\n                <label \n                  className={`flex cursor-pointer rounded-lg border p-4 ${plan === 'personal' ? 'bg-teal-900 border-teal-500 ring-2 ring-teal-500' : 'bg-blue-800/50 border-blue-700 hover:bg-blue-800'}`}\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"plan\"\n                    value=\"personal\"\n                    checked={plan === 'personal'}\n                    onChange={() => setPlan('personal')}\n                    className=\"h-4 w-4 mt-0.5 text-teal-600 focus:ring-teal-500 border-gray-500\"\n                  />\n                  <span className=\"ml-3 block text-sm font-medium text-white\">Plan Personal</span>\n                </label>\n                {/* Opción B2B */}\n                <label \n                  className={`flex cursor-pointer rounded-lg border p-4 ${plan !== 'personal' ? 'bg-teal-900 border-teal-500 ring-2 ring-teal-500' : 'bg-blue-800/50 border-blue-700 hover:bg-blue-800'}`}\n                >\n                  <input\n                    type=\"radio\"\n                    name=\"plan\"\n                    value=\"profesional\" // 'profesional' o 'estudio' se manejan igual\n                    checked={plan !== 'personal'}\n                    onChange={() => setPlan('profesional')} // Asumimos B2B\n                    className=\"h-4 w-4 mt-0.5 text-teal-600 focus:ring-teal-500 border-gray-500\"\n                  />\n                  <span className=\"ml-3 block text-sm font-medium text-white\">Profesional / Estudio</span>\n                </label>\n              </div>\n            </fieldset>\n\n            {/* Campo Condicional: Nombre de Organización */}\n            {plan !== 'personal' && (\n              <div> {/* (Ana puede añadir una animación simple aquí) */}\n                <label htmlFor=\"orgName\" className=\"block text-sm font-medium leading-6 text-blue-200\">\n                  Nombre de tu Estudio / Organización\n                </label>\n                <div className=\"mt-2\">\n                  <input\n                    id=\"orgName\"\n                    name=\"orgName\"\n                    type=\"text\"\n                    // required={plan !== 'personal'}\n                    value={orgName}\n                    onChange={(e) => setOrgName(e.target.value)}\n                    className=\"block w-full rounded-md border-0 bg-blue-800/50 py-2.5 text-white ring-1 ring-inset ring-blue-700 focus:ring-2 focus:ring-inset focus:ring-teal-500\"\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Checkbox de Política de Privacidad (BLOQUEADO HASTA TAREA N-1) */}\n            <div className=\"flex items-center space-x-3\">\n              <input\n                id=\"policy\"\n                name=\"policy\"\n                type=\"checkbox\"\n                checked={agreedToPolicy}\n                onChange={(e) => setAgreedToPolicy(e.target.checked)}\n                className=\"h-4 w-4 rounded bg-blue-800 border-blue-700 text-teal-600 focus:ring-teal-500\"\n              />\n              <label htmlFor=\"policy\" className=\"text-sm leading-6 text-blue-300\">\n                Acepto la <a href=\"/politica-privacidad\" target=\"_blank\" className=\"font-semibold text-teal-400 hover:text-teal-300\">Política de Privacidad</a>\n              </label>\n            </div>\n\n            {/* Mensaje de Error */}\n            {error && (\n              <div className=\"rounded-md bg-red-900/50 p-3 ring-1 ring-red-700\">\n                <p className=\"text-sm text-red-300\">{error}</p>\n              </div>\n            )}\n\n            {/* Botón de Submit */}\n            <div>\n              <button\n                type=\"submit\"\n                disabled={isLoading || !agreedToPolicy} // Deshabilitado si está cargando o no aceptó\n                className=\"flex w-full justify-center rounded-md bg-teal-500 px-3 py-2.5 text-sm font-semibold leading-6 text-blue-950 shadow-sm hover:bg-teal-400 focus-visible:outline disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                 {isLoading ? (\n                  <Loader2 className=\"h-5 w-5 animate-spin\" />\n                ) : (\n                  'Crear Cuenta'\n                )}\n              </button>\n            </div>\n          </form>\n\n          {/* Link a Login */}\n          <p className=\"mt-10 text-center text-sm text-blue-300\">\n            ¿Ya tienes una cuenta?{' '}\n            <Link href=\"/login\" className=\"font-semibold leading-6 text-teal-400 hover:text-teal-300\">\n              Inicia Sesión aquí\n            </Link>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}